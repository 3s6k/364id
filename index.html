<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3s6k Multi-Token Checker</title>
    <style>
        :root {
            --bg-color: #0a0a0b;
            --card-bg: #16161a;
            --accent-color: #7289da;
            --success-color: #2ecc71;
            --danger-color: #ff4d4d;
            --text-main: #ffffff;
            --text-sub: #b9bbbe;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-color); color: var(--text-main); padding: 15px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 700px; }
        .card { background: var(--card-bg); padding: 20px; border-radius: 12px; border: 1px solid #2e2e32; margin-bottom: 20px; }
        textarea { width: 100%; padding: 12px; border-radius: 6px; border: 1px solid #2e2e32; background: #1f1f23; color: white; outline: none; font-family: monospace; resize: vertical; }

        /* フィルター設定エリア */
        .filter-group { display: flex; gap: 20px; margin: 10px 0 15px 0; background: #1f1f23; padding: 12px; border-radius: 6px; border: 1px solid #2e2e32; }
        .filter-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; cursor: pointer; color: var(--text-main); }
        .filter-item input { width: 18px; height: 18px; cursor: pointer; accent-color: var(--accent-color); }

        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { padding: 12px; border-radius: 6px; border: none; background: var(--accent-color); color: white; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-stop { background: #333; }
        .btn-copy { background: #4e5d94; margin-top: 10px; width: 100%; }

        .log-container {
            background: #000; border-radius: 8px; padding: 12px; height: 250px; overflow-y: scroll;
            font-family: 'Consolas', monospace; font-size: 0.8rem; border: 1px solid #2e2e32; margin-bottom: 15px;
        }
        .hit-area { border: 1px solid var(--success-color); border-radius: 8px; padding: 15px; background: rgba(46, 204, 113, 0.05); }
        .hit-list { min-height: 80px; max-height: 150px; overflow-y: auto; font-family: monospace; color: var(--success-color); white-space: pre-wrap; word-break: break-all; }
        .log-entry { margin-bottom: 2px; }
        .available { color: var(--success-color); }
        .error { color: var(--danger-color); }
        .status-info { font-size: 0.8rem; color: var(--text-sub); margin-bottom: 10px; text-align: right; }
    </style>
</head>
<body>

<div class="container">
    <header style="text-align:center; margin-bottom:20px;">
        <h1 style="color:var(--accent-color); font-size: 1.8rem;">3s6k Multi-Token Checker</h1>
    </header>

    <div class="card">
        <label style="font-size: 0.9rem; color: var(--text-sub);">Tokens (カンマ区切り)</label>
        <textarea id="tokens" rows="3" placeholder="token1, token2, token3..."></textarea>

        <div class="filter-group">
            <label class="filter-item">
                <input type="checkbox" id="allow-numbers"> <b>数字 (0-9)</b>
            </label>
            <label class="filter-item">
                <input type="checkbox" id="allow-symbols"> <b>記号 (. _)</b>
            </label>
        </div>
        <p style="font-size: 0.75rem; color: var(--text-sub); margin-top: -10px; margin-bottom: 15px; margin-left: 5px;">
            ※英字(a-z)は常に含まれます。
        </p>

        <div class="btn-group">
            <button id="start-btn" class="btn" onclick="startChecking()">スキャン開始</button>
            <button id="stop-btn" class="btn btn-stop" onclick="stopChecking()">停止</button>
        </div>
    </div>

    <div class="card">
        <div class="status-info" id="status-display">トークン数: 0 | 待機中...</div>
        <div id="log" class="log-container"></div>

        <div class="hit-area">
            <h3 style="font-size: 0.9rem; margin-bottom: 10px; color: var(--success-color);">Available Usernames</h3>
            <div id="hit-list" class="hit-list">ヒットした4文字がここに表示されます</div>
            <button class="btn btn-copy" onclick="copyHits()">結果をコピー</button>
        </div>
    </div>
</div>

<script>
    let isChecking = false;
    let hits = [];
    let tokenCooldowns = {};

    function generateTarget() {
        const useNum = document.getElementById('allow-numbers').checked;
        const useSym = document.getElementById('allow-symbols').checked;

        let chars = "abcdefghijklmnopqrstuvwxyz"; // 英字は固定
        if (useNum) chars += "0123456789";
        if (useSym) chars += "._";

        let res = "";
        for (let i = 0; i < 4; i++) res += chars.charAt(Math.floor(Math.random() * chars.length));
        return res;
    }

    function addLog(text, className = "") {
        const log = document.getElementById('log');
        const entry = document.createElement('div');
        entry.className = "log-entry " + className;
        entry.innerText = `[${new Date().toLocaleTimeString()}] ${text}`;
        log.prepend(entry);
    }

    async function checkUsername(token, username) {
        try {
            const res = await fetch("https://discord.com/api/v9/users/@me/pomelo-attempt", {
                method: "POST",
                headers: { "Authorization": token.trim(), "Content-Type": "application/json" },
                body: JSON.stringify({ username: username })
            });
            if (res.status === 429) {
                const data = await res.json();
                return { status: 'ratelimit', retry_after: data.retry_after || 5 };
            }
            if (!res.ok) return { status: 'invalid' };
            const data = await res.json();
            return { status: 'ok', taken: !data.taken };
        } catch (e) { return { status: 'error' }; }
    }

    async function startChecking() {
        const tokenInput = document.getElementById('tokens').value;
        const tokenList = tokenInput.split(',').map(t => t.trim()).filter(t => t !== "");
        if (tokenList.length === 0) return alert("トークンを入力してください");

        isChecking = true;
        document.getElementById('start-btn').disabled = true;
        addLog(`${tokenList.length}個のトークンでスキャン開始`);

        let tokenIndex = 0;
        while (isChecking) {
            const currentToken = tokenList[tokenIndex];
            const now = Date.now();

            if (tokenCooldowns[currentToken] && now < tokenCooldowns[currentToken]) {
                tokenIndex = (tokenIndex + 1) % tokenList.length;
                await new Promise(r => setTimeout(r, 100));
                continue;
            }

            const target = generateTarget();
            const result = await checkUsername(currentToken, target);

            if (result.status === 'ok') {
                if (result.taken) {
                    addLog(`HIT: ${target}`, "available");
                    hits.push(target);
                    document.getElementById('hit-list').innerText = hits.join(', ');
                } else {
                    addLog(`Taken: ${target}`);
                }
            } else if (result.status === 'ratelimit') {
                addLog(`Token ${tokenIndex + 1} Limit: ${result.retry_after}s`, "error");
                tokenCooldowns[currentToken] = now + (result.retry_after * 1000);
            } else if (result.status === 'invalid') {
                addLog(`Token ${tokenIndex + 1} Invalid`, "error");
            }

            tokenIndex = (tokenIndex + 1) % tokenList.length;
            document.getElementById('status-display').innerText = `トークン数: ${tokenList.length} | 実行中...`;
            await new Promise(r => setTimeout(r, 300));
        }
    }

    function stopChecking() {
        isChecking = false;
        document.getElementById('start-btn').disabled = false;
        addLog("停止しました");
    }

    function copyHits() {
        if (hits.length === 0) return;
        navigator.clipboard.writeText(hits.join('\n'));
        alert("ヒットリストをコピーしました");
    }
</script>

</body>
</html>
